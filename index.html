<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluaci√≥n de Madurez Digital - Sector Agropecuario</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script> 
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body class="p-0 m-0">
    <div id="root"></div>

    <script type="text/babel"> 
        const { useState, useRef, useEffect, useCallback } = React;
        const Chart = window.Chart; // Acceso global a Chart.js

        // ====================================================================
        // II. COMPONENTES DE GR√ÅFICOS (Chart.js)
        // ====================================================================
        
        const ChartComponent = ({ type, data, options, chartId }) => {
            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            useEffect(() => {
                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }

                if (!chartRef.current) return;

                const ctx = chartRef.current.getContext('2d');
                chartInstance.current = new Chart(ctx, {
                    type: type,
                    data: data,
                    options: options,
                });

                return () => {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                };
            }, [type, data, options]);

            return <canvas ref={chartRef} id={chartId}></canvas>;
        };

        const RadarChartDisplay = ({ data, colors }) => {
            const dimLabels = data.map(d => d.dimension);
            const scoreValues = data.map(d => d.score);

            const chartData = {
                labels: dimLabels,
                datasets: [{
                    label: 'Puntaje',
                    data: scoreValues,
                    backgroundColor: `rgba(${colors.rgb}, 0.4)`,
                    borderColor: colors.hex,
                    pointBackgroundColor: colors.hex,
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: colors.hex,
                    borderWidth: 2
                }]
            };

            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: { callbacks: { label: (context) => `Puntaje: ${context.raw}/25` } }
                },
                scales: {
                    r: {
                        angleLines: { color: 'rgba(0, 0, 0, 0.1)' },
                        grid: { color: 'rgba(0, 0, 0, 0.1)' },
                        suggestedMin: 0,
                        suggestedMax: 25,
                        pointLabels: { font: { size: 12, weight: '600' }, color: '#1e293b' },
                        ticks: { stepSize: 5, backdropColor: 'white' }
                    }
                }
            };

            return (
                <div style={{ height: '400px' }}>
                    <ChartComponent 
                        type="radar" 
                        data={chartData} 
                        options={chartOptions} 
                        chartId="radarChart"
                    />
                </div>
            );
        };

        const BarChartDisplay = ({ data }) => {
            const dimLabels = data.map(d => d.name);
            const scoreValues = data.map(d => d.score);
            const barColors = data.map(d => d.color);

            const chartData = {
                labels: dimLabels,
                datasets: [{
                    label: 'Puntaje',
                    data: scoreValues,
                    backgroundColor: barColors,
                    borderColor: barColors,
                    borderWidth: 1
                }]
            };

            const chartOptions = {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: { callbacks: { label: (context) => `Puntaje: ${context.raw}/25` } }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        max: 25,
                        ticks: { stepSize: 5 },
                        grid: { drawOnChartArea: true }
                    },
                    y: {
                        grid: { drawOnChartArea: false }
                    }
                }
            };

            return (
                <div style={{ height: '400px' }}>
                    <ChartComponent 
                        type="bar" 
                        data={chartData} 
                        options={chartOptions} 
                        chartId="barChart"
                    />
                </div>
            );
        };


        // ====================================================================
        // III. COMPONENTE PRINCIPAL (MadurezDigitalAgro)
        // ====================================================================

        const MadurezDigitalAgro = () => {
            const [currentStep, setCurrentStep] = useState(0);
            const [showResults, setShowResults] = useState(false);
            // Estado restaurado para todos los campos de contacto
            const [companyName, setCompanyName] = useState('');
            const [personName, setPersonName] = useState('');
            const [position, setPosition] = useState('');
            const [email, setEmail] = useState('');
            const [phone, setPhone] = useState('');
            const [responses, setResponses] = useState({});
            const [submissionStatus, setSubmissionStatus] = useState('idle'); // idle | loading | success | error

            const dimensions = [
                { id: 'produccion', name: 'Producci√≥n y Operaciones', icon: 'üåæ', color: '#10b981', rgb: '16, 185, 129', questions: [ { id: 'p1', text: '¬øC√≥mo registra actualmente sus actividades de campo?', options: [ { value: 1, label: 'Papel y l√°piz, registros manuales' }, { value: 2, label: 'Excel b√°sico, sin estructura clara' }, { value: 3, label: 'Software agr√≠cola con registros digitales' }, { value: 4, label: 'Sensores IoT y dashboards en tiempo real' }, { value: 5, label: 'IA predictiva, agricultura de precisi√≥n completa' } ] }, { id: 'p2', text: '¬øC√≥mo monitorea el estado de sus cultivos/ganado?', options: [ { value: 1, label: 'Inspecci√≥n visual manual' }, { value: 2, label: 'Reportes b√°sicos del personal' }, { value: 3, label: 'Software de gesti√≥n con alertas' }, { value: 4, label: 'Sensores, c√°maras, monitoreo remoto' }, { value: 5, label: 'Drones, sat√©lites, an√°lisis con IA' } ] }, { id: 'p3', text: '¬øC√≥mo controla el uso de agua, fertilizantes e insumos?', options: [ { value: 1, label: 'Aplicaci√≥n manual sin medici√≥n' }, { value: 2, label: 'Registros b√°sicos de consumo' }, { value: 3, label: 'Sistemas de medici√≥n digital' }, { value: 4, label: 'Riego automatizado, aplicaci√≥n variable' }, { value: 5, label: 'Optimizaci√≥n con IA, prescripci√≥n por zonas' } ] }, { id: 'p4', text: '¬øC√≥mo gestiona el mantenimiento de su maquinaria?', options: [ { value: 1, label: 'Reactivo, cuando se da√±a' }, { value: 2, label: 'Calendario b√°sico de mantenimiento' }, { value: 3, label: 'Software de gesti√≥n de activos' }, { value: 4, label: 'Telemetr√≠a, mantenimiento predictivo' }, { value: 5, label: 'Maquinaria aut√≥noma, optimizaci√≥n con IA' } ] }, { id: 'p5', text: '¬øPuede visualizar en tiempo real lo que sucede en su operaci√≥n?', options: [ { value: 1, label: 'No, solo inspecciones peri√≥dicas' }, { value: 2, label: 'Reportes diarios/semanales manuales' }, { value: 3, label: 'Reportes digitales actualizados' }, { value: 4, label: 'Dashboards en tiempo real' }, { value: 5, label: 'Control total 24/7 desde cualquier lugar' } ] } ] },
                { id: 'datos', name: 'Datos y Anal√≠tica', icon: 'üìä', color: '#3b82f6', rgb: '59, 130, 246', questions: [ { id: 'd1', text: '¬øRegistra datos de producci√≥n, clima y costos sistem√°ticamente?', options: [ { value: 1, label: 'No registro datos de forma sistem√°tica' }, { value: 2, label: 'Algunos datos en planillas dispersas' }, { value: 3, label: 'Captura digital estructurada' }, { value: 4, label: 'Captura autom√°tica con sensores' }, { value: 5, label: 'Captura multi-fuente integrada' } ] }, { id: 'd2', text: '¬øQu√© porcentaje de sus datos est√° digitalizado?', options: [ { value: 1, label: '0-20% (casi todo en papel)' }, { value: 2, label: '21-40% (algunos datos digitales)' }, { value: 3, label: '41-60% (la mayor√≠a digital)' }, { value: 4, label: '61-80% (casi todo digital)' }, { value: 5, label: '81-100% (100% digital)' } ] }, { id: 'd3', text: '¬øAnaliza datos para tomar decisiones de producci√≥n?', options: [ { value: 1, label: 'Decisiones por intuici√≥n/experiencia' }, { value: 2, label: 'Reviso datos hist√≥ricos ocasionalmente' }, { value: 3, label: 'An√°lisis de tendencias regular' }, { value: 4, label: 'Modelos predictivos b√°sicos' }, { value: 5, label: 'IA para optimizaci√≥n continua' } ] }, { id: 'd4', text: '¬øPuede acceder a todos sus datos desde un solo lugar?', options: [ { value: 1, label: 'Datos aislados en m√∫ltiples lugares' }, { value: 2, label: 'Consolidaci√≥n manual ocasional' }, { value: 3, label: 'Base de datos centralizada' }, { value: 4, label: 'ERP agr√≠cola integrado' }, { value: 5, label: 'Plataforma unificada con APIs' } ] }, { id: 'd5', text: '¬øPuede predecir rendimientos, problemas o necesidades?', options: [ { value: 1, label: 'No, solo reacciono a lo que pasa' }, { value: 2, label: 'Estimaciones b√°sicas por experiencia' }, { value: 3, label: 'Proyecciones con datos hist√≥ricos' }, { value: 4, label: 'Modelos predictivos confiables' }, { value: 5, label: 'IA con precisi√≥n alta en predicciones' } ] } ] },
                { id: 'trazabilidad', name: 'Trazabilidad y Cadena', icon: 'üîó', color: '#8b5cf6', rgb: '139, 92, 246', questions: [ { id: 't1', text: '¬øPuede rastrear un producto desde el origen hasta el cliente?', options: [ { value: 1, label: 'No tengo sistema de trazabilidad' }, { value: 2, label: 'Registros b√°sicos por lote en papel' }, { value: 3, label: 'Trazabilidad digital por lote' }, { value: 4, label: 'Trazabilidad unitaria con QR/RFID' }, { value: 5, label: 'Blockchain, transparencia total' } ] }, { id: 't2', text: '¬øSus clientes pueden verificar el origen de sus productos?', options: [ { value: 1, label: 'No, no hay informaci√≥n disponible' }, { value: 2, label: 'Informaci√≥n b√°sica si la solicitan' }, { value: 3, label: 'Certificados digitales disponibles' }, { value: 4, label: 'C√≥digo QR con informaci√≥n completa' }, { value: 5, label: 'Plataforma de transparencia en tiempo real' } ] }, { id: 't3', text: '¬øConoce en tiempo real sus niveles de inventario?', options: [ { value: 1, label: 'Control visual, sin registros' }, { value: 2, label: 'Inventarios manuales peri√≥dicos' }, { value: 3, label: 'Sistema digital de inventarios' }, { value: 4, label: 'Inventario en tiempo real automatizado' }, { value: 5, label: 'Optimizaci√≥n predictiva de inventarios' } ] }, { id: 't4', text: '¬øOptimiza digitalmente sus rutas de distribuci√≥n?', options: [ { value: 1, label: 'Gesti√≥n manual sin planificaci√≥n' }, { value: 2, label: 'Planificaci√≥n b√°sica en papel' }, { value: 3, label: 'Software de gesti√≥n log√≠stica' }, { value: 4, label: 'Optimizaci√≥n de rutas con GPS' }, { value: 5, label: 'Log√≠stica predictiva automatizada' } ] }, { id: 't5', text: '¬øPuede rastrear en tiempo real sus env√≠os?', options: [ { value: 1, label: 'No, solo confirmo al entregar' }, { value: 2, label: 'Llamadas telef√≥nicas al conductor' }, { value: 3, label: 'Reporte al finalizar el d√≠a' }, { value: 4, label: 'GPS tracking en tiempo real' }, { value: 5, label: 'Plataforma completa con alertas' } ] } ] },
                { id: 'comercial', name: 'Comercializaci√≥n', icon: 'üíº', color: '#f59e0b', rgb: '245, 158, 11', questions: [ { id: 'c1', text: '¬øVende sus productos por canales digitales?', options: [ { value: 1, label: 'Solo venta presencial/telef√≥nica' }, { value: 2, label: 'Email y WhatsApp b√°sico' }, { value: 3, label: 'P√°gina web informativa' }, { value: 4, label: 'E-commerce propio o plataformas' }, { value: 5, label: 'Omnicanal con marketplace y IA' } ] }, { id: 'c2', text: '¬øQu√© porcentaje de sus ventas es digital?', options: [ { value: 1, label: '0% (todo presencial)' }, { value: 2, label: '1-25% (algo digital)' }, { value: 3, label: '26-50% (mitad digital)' }, { value: 4, label: '51-75% (mayor√≠a digital)' }, { value: 5, label: '76-100% (casi todo digital)' } ] }, { id: 'c3', text: '¬øGestiona digitalmente la relaci√≥n con sus clientes?', options: [ { value: 1, label: 'No gestiono relaci√≥n con clientes' }, { value: 2, label: 'Contactos en agenda/Excel' }, { value: 3, label: 'CRM b√°sico' }, { value: 4, label: 'CRM integrado con ventas' }, { value: 5, label: 'CRM con IA y personalizaci√≥n' } ] }, { id: 'c4', text: '¬øMonitorea digitalmente precios y tendencias de mercado?', options: [ { value: 1, label: 'No monitoreo el mercado' }, { value: 2, label: 'Consulta ocasional de precios' }, { value: 3, label: 'Monitoreo regular manual' }, { value: 4, label: 'Plataformas con alertas de precios' }, { value: 5, label: 'IA predictiva de mercados' } ] }, { id: 'c5', text: '¬øConoce las preferencias y historial de sus clientes?', options: [ { value: 1, label: 'No tengo registro de clientes' }, { value: 2, label: 'Memoria personal b√°sica' }, { value: 3, label: 'Base de datos de clientes' }, { value: 4, label: 'Historial completo digitalizado' }, { value: 5, label: 'An√°lisis predictivo de comportamiento' } ] } ] },
                { id: 'finanzas', name: 'Gesti√≥n Financiera', icon: 'üí∞', color: '#ef4444', rgb: '239, 68, 68', questions: [ { id: 'f1', text: '¬øUtiliza software contable especializado?', options: [ { value: 1, label: 'Registros manuales en papel' }, { value: 2, label: 'Excel b√°sico' }, { value: 3, label: 'Software contable est√°ndar' }, { value: 4, label: 'ERP integrado' }, { value: 5, label: 'Finanzas predictivas con IA' } ] }, { id: 'f2', text: '¬øPuede acceder a informaci√≥n financiera en tiempo real?', options: [ { value: 1, label: 'No, solo revisiones mensuales' }, { value: 2, label: 'Reportes semanales manuales' }, { value: 3, label: 'Reportes diarios digitales' }, { value: 4, label: 'Dashboard financiero en tiempo real' }, { value: 5, label: 'Anal√≠tica avanzada con alertas' } ] }, { id: 'f3', text: '¬øGestiona digitalmente planillas y asistencia de personal?', options: [ { value: 1, label: 'Control manual de asistencia' }, { value: 2, label: 'Planillas b√°sicas en Excel' }, { value: 3, label: 'Software de RRHH b√°sico' }, { value: 4, label: 'Sistema integrado con biometr√≠a' }, { value: 5, label: 'Plataforma con an√°lisis de productividad' } ] }, { id: 'f4', text: '¬øUtiliza herramientas digitales para planificar su negocio?', options: [ { value: 1, label: 'No tengo planificaci√≥n formal' }, { value: 2, label: 'Presupuestos b√°sicos en papel' }, { value: 3, label: 'Planificaci√≥n digital estructurada' }, { value: 4, label: 'Modelos financieros din√°micos' }, { value: 5, label: 'Planificaci√≥n predictiva con escenarios' } ] }, { id: 'f5', text: '¬øEmite facturas electr√≥nicas?', options: [ { value: 1, label: 'No, solo facturas en papel' }, { value: 2, label: 'Algunas facturas digitales' }, { value: 3, label: 'Mayor√≠a son electr√≥nicas' }, { value: 4, label: '100% facturaci√≥n electr√≥nica' }, { value: 5, label: 'Facturaci√≥n autom√°tica integrada' } ] } ] },
                { id: 'cultura', name: 'Cultura Digital', icon: 'üë•', color: '#ec4899', rgb: '236, 72, 153', questions: [ { id: 'cu1', text: '¬øSu equipo usa herramientas digitales con facilidad?', options: [ { value: 1, label: 'Resistencia al cambio, sin habilidades' }, { value: 2, label: 'Uso muy b√°sico de tecnolog√≠a' }, { value: 3, label: 'Manejo de software espec√≠fico' }, { value: 4, label: 'Adopci√≥n proactiva de tecnolog√≠a' }, { value: 5, label: 'Innovaci√≥n continua, mentalidad digital' } ] }, { id: 'cu2', text: '¬øQu√© porcentaje de empleados tiene smartphone?', options: [ { value: 1, label: '0-20%' }, { value: 2, label: '21-40%' }, { value: 3, label: '41-60%' }, { value: 4, label: '61-80%' }, { value: 5, label: '81-100%' } ] }, { id: 'cu3', text: '¬øCapacita regularmente a su equipo en tecnolog√≠a?', options: [ { value: 1, label: 'No hay capacitaciones' }, { value: 2, label: 'Capacitaci√≥n ocasional b√°sica' }, { value: 3, label: 'Programa anual de capacitaci√≥n' }, { value: 4, label: 'Capacitaci√≥n continua planificada' }, { value: 5, label: 'Cultura de aprendizaje permanente' } ] }, { id: 'cu4', text: '¬øLa gerencia promueve activamente la digitalizaci√≥n?', options: [ { value: 1, label: 'L√≠deres reacios a tecnolog√≠a' }, { value: 2, label: 'Conciencia pero sin acci√≥n' }, { value: 3, label: 'Apoyo a iniciativas digitales' }, { value: 4, label: 'L√≠deres impulsan transformaci√≥n' }, { value: 5, label: 'Liderazgo visionario en innovaci√≥n' } ] }, { id: 'cu5', text: '¬øQu√© % de ingresos invierte en tecnolog√≠a anualmente?', options: [ { value: 1, label: '0% (sin inversi√≥n)' }, { value: 2, label: '0.5-1% (muy poco)' }, { value: 3, label: '2-3% (moderado)' }, { value: 4, label: '4-5% (significativo)' }, { value: 5, label: '6%+ (innovaci√≥n prioridad)' } ] } ] }
            ];

            const handleResponse = (questionId, value) => {
                setResponses({ ...responses, [questionId]: value });
            };

            const calculateDimensionScore = (dimension) => {
                const questionIds = dimension.questions.map(q => q.id);
                const scores = questionIds.map(id => responses[id] || 0);
                return scores.reduce((a, b) => a + b, 0);
            };

            const calculateTotalScore = () => {
                return dimensions.reduce((total, dim) => total + calculateDimensionScore(dim), 0);
            };

            const getMaxScore = () => dimensions.length * 5 * 5; 

            const getDimensionLevel = (score) => {
                if (score <= 5) return { level: 1, label: 'An√°logo', color: '#ef4444' };
                if (score <= 10) return { level: 2, label: 'B√°sico', color: '#f59e0b' };
                if (score <= 15) return { level: 3, label: 'Establecido', color: '#eab308' };
                if (score <= 20) return { level: 4, label: 'Avanzado', color: '#3b82f6' };
                return { level: 5, label: 'L√≠der', color: '#10b981' };
            };

            const getOverallLevel = (totalScore) => {
                if (totalScore <= 30) return { level: 'Etapa An√°loga', color: '#ef4444', icon: 'üî¥', description: 'Empresa tradicional con procesos manuales', priority: 'URGENTE: Iniciar transformaci√≥n digital', actions: ['Digitalizar procesos b√°sicos', 'Capacitar equipo', 'Implementar software esencial'], timeframe: '18-24 meses al nivel 3' };
                if (totalScore <= 60) return { level: 'Inicio Digital', color: '#f59e0b', icon: 'üü°', description: 'Adopci√≥n b√°sica, herramientas aisladas', priority: 'Consolidar y estructurar sistemas', actions: ['Integrar sistemas existentes', 'Estandarizar procesos', 'Expandir capacitaci√≥n'], timeframe: '12-18 meses al nivel 3' };
                if (totalScore <= 90) return { level: 'Digital Establecido', color: '#eab308', icon: 'üü†', description: 'Procesos digitalizados funcionando', priority: 'Optimizar y automatizar', actions: ['Implementar anal√≠tica avanzada', 'Automatizar procesos', 'Explorar IoT'], timeframe: '12 meses al nivel 4' };
                if (totalScore <= 120) return { level: 'Digital Avanzado', color: '#3b82f6', icon: 'üîµ', description: 'L√≠der en adopci√≥n tecnol√≥gica', priority: 'Innovaci√≥n disruptiva', actions: ['Implementar IA', 'Agricultura de precisi√≥n', 'Blockchain'], timeframe: 'Innovaci√≥n continua' };
                return { level: 'L√≠der Digital', color: '#10b981', icon: 'üü¢', description: 'Referente del sector', priority: 'Mantener ventaja competitiva', actions: ['Explorar tecnolog√≠as emergentes', 'Mentor√≠a a otros', 'Innovaci√≥n radical'], timeframe: 'Liderazgo sostenido' };
            };

            const isStepComplete = () => {
                // Paso 0 es el formulario de contacto, el resto son dimensiones de preguntas.
                if (currentStep === 0) {
                    return companyName.trim() !== '' && personName.trim() !== '';
                }
                const currentDimension = dimensions[currentStep - 1]; // Ajuste de √≠ndice para los pasos de preguntas
                return currentDimension.questions.every(q => responses[q.id] !== undefined);
            };
            
            // L√≥gica de validaci√≥n de campos obligatorios
            const isContactStepComplete = companyName.trim() !== '' && personName.trim() !== '';

            const progressPercentage = () => {
                const totalQuestions = dimensions.reduce((sum, dim) => sum + dim.questions.length, 0);
                const answeredQuestions = Object.keys(responses).length;
                return (answeredQuestions / totalQuestions) * 100;
            };

            const getRadarData = () => {
                return dimensions.map(dim => ({
                    dimension: dim.name.split(' ')[0], 
                    score: calculateDimensionScore(dim),
                    fullMark: 25 
                }));
            };

            const getBarData = () => {
                return dimensions.map(dim => {
                    const score = calculateDimensionScore(dim);
                    const level = getDimensionLevel(score);
                    return {
                        name: dim.icon + ' ' + dim.name,
                        score: score,
                        nivel: level.label,
                        color: level.color
                    };
                });
            };

            const resetEvaluation = () => {
                setResponses({});
                setCurrentStep(0);
                setShowResults(false);
                setCompanyName('');
                setPersonName('');
                setPosition('');
                setEmail('');
                setPhone('');
                setSubmissionStatus('idle');
            };

            // INICIO: Funci√≥n de captura de datos con el KEY del usuario
            const handleDataCapture = async () => {
                // ‚ö†Ô∏è ¬°ACCI√ìN REQUERIDA! REEMPLAZAR ESTA LLAVE CON SU LLAVE REAL DE WEB3FORMS ‚ö†Ô∏è
                // Una vez que la reemplace, la advertencia desaparecer√° y los datos se guardar√°n.
                const WEB3FORMS_ACCESS_KEY = 'b143cd22-5cdf-476b-8197-e8fcbb460be7'; // <-- PEGUE SU LLAVE DE WEB3FORMS AQU√ç

                // Advertencia para el usuario si no ha cambiado la llave
                if (WEB3FORMS_ACCESS_KEY === '' || WEB3FORMS_ACCESS_KEY.includes('b143cd22')) {
                    alert("¬°ADVERTENCIA! Debe reemplazar el valor vac√≠o o la llave de prueba con su llave de Web3Forms (obtenida en https://web3forms.com/) para guardar los datos.");
                    setSubmissionStatus('error'); // Mostrar error en el front-end si la llave es de prueba
                    return;
                }
                
                setSubmissionStatus('loading');
                const totalScore = calculateTotalScore();
                const overallLevel = getOverallLevel(totalScore);

                const dataToSend = {
                    // CONFIGURACI√ìN DE WEB3FORMS:
                    'access_key': WEB3FORMS_ACCESS_KEY,
                    
                    // DATOS DE CONTACTO 
                    'Empresa': companyName,
                    'Nombre': personName,
                    'Cargo': position,
                    'Email': email,
                    'Tel√©fono': phone,
                    'Fecha': new Date().toLocaleString('es-ES'), // Formato legible de fecha/hora
                    
                    // PUNTAJES DE RESUMEN
                    'Puntaje General': `${totalScore}/${getMaxScore()}`,
                    'Nivel de Madurez': overallLevel.level,
                    'Score Producci√≥n': calculateDimensionScore(dimensions.find(d => d.id === 'produccion')),
                    'Score Datos': calculateDimensionScore(dimensions.find(d => d.id === 'datos')),
                    'Score Trazabilidad': calculateDimensionScore(dimensions.find(d => d.id === 'trazabilidad')),
                    'Score Comercial': calculateDimensionScore(dimensions.find(d => d.id === 'comercial')),
                    'Score Finanzas': calculateDimensionScore(dimensions.find(d => d.id === 'finanzas')),
                    'Score Cultura': calculateDimensionScore(dimensions.find(d => d.id === 'cultura')),
                    
                    // DETALLE DE RESPUESTAS COMPLETAS
                    'Detalle de Respuestas': JSON.stringify(responses), 
                };

                try {
                    // Se usa await dentro de esta funci√≥n async
                    const response = await fetch('https://api.web3forms.com/submit', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json' 
                        },
                        body: JSON.stringify(dataToSend)
                    });

                    if (response.ok) {
                        setSubmissionStatus('success');
                    } else {
                        setSubmissionStatus('error');
                        console.error('Error al enviar los datos:', response.status, await response.text());
                    }
                } catch (error) {
                    setSubmissionStatus('error');
                    console.error('Error de red/fetch:', error);
                }
            };
            // FIN: Funci√≥n de captura de datos con el KEY del usuario

            // L√≥gica para avanzar al siguiente paso
            const goToNextStep = () => {
                // Validaci√≥n para el paso de contacto (Paso 0)
                if (currentStep === 0 && !isContactStepComplete) {
                    alert("Por favor, complete los campos de Nombre de Empresa y Nombre de Contacto para empezar la evaluaci√≥n.");
                    return;
                }
                
                // Validaci√≥n para los pasos de preguntas (Pasos 1 a 6)
                if (currentStep > 0 && currentStep <= dimensions.length && !isStepComplete()) {
                    alert("Por favor, responda todas las preguntas de esta secci√≥n antes de continuar.");
                    return;
                }

                // Si estamos en la √∫ltima dimensi√≥n y es el √∫ltimo bot√≥n
                if (currentStep === dimensions.length) { 
                    handleDataCapture();
                    setShowResults(true);
                } else {
                    // Avanzamos el paso (de 0 a 1, de 1 a 2, etc.)
                    setCurrentStep(currentStep + 1); 
                }
            };

            const goToPrevStep = () => {
                if (currentStep > 0) {
                    setCurrentStep(currentStep - 1);
                }
            };

            // --- Componentes Reutilizables ---
            const InputField = ({ label, id, value, onChange, type = 'text', required = false }) => (
                <div className="mb-4">
                    <label htmlFor={id} className="block text-sm font-medium text-gray-700 mb-1">
                        {label} {required && <span className="text-red-500">*</span>}
                    </label>
                    <input
                        type={type}
                        id={id}
                        value={value}
                        onChange={(e) => onChange(e.target.value)}
                        required={required}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150"
                        placeholder={label}
                    />
                </div>
            );

            // --- Vistas de la Aplicaci√≥n ---

            if (showResults) {
                const totalScore = calculateTotalScore();
                const overallLevel = getOverallLevel(totalScore);
                const radarData = getRadarData();
                const barData = getBarData();

                let submissionMessage = null;
                if (submissionStatus === 'loading') {
                    submissionMessage = <span className="text-blue-600 font-bold">...Guardando resultados autom√°ticamente...</span>;
                } else if (submissionStatus === 'success') {
                    submissionMessage = <span className="text-green-600 font-bold">‚úÖ Resultados guardados con √©xito.</span>;
                } else if (submissionStatus === 'error') {
                    submissionMessage = <span className="text-red-600 font-bold">‚ùå Error al guardar los resultados. **Revise su llave de Web3Forms**.</span>;
                }


                return (
                    <div className="min-h-screen bg-gradient-to-br from-green-50 via-blue-50 to-purple-50 p-4">
                        <div className="max-w-7xl mx-auto" id="reporte-contenido">
                            {/* Header */}
                            <div className="bg-white rounded-2xl shadow-xl p-8 mb-6">
                                <div className="flex items-center justify-between mb-4">
                                    <div>
                                        <h1 className="text-4xl font-bold text-gray-800 mb-2">
                                            Resultados de Madurez Digital
                                        </h1>
                                        <div className="text-lg text-gray-600 space-y-1">
                                            <p><strong className="text-gray-800">Empresa:</strong> {companyName}</p>
                                            <p><strong className="text-gray-800">Contacto:</strong> {personName} (<span className="italic">{position || 'Sin cargo especificado'}</span>)</p>
                                            <p><strong className="text-gray-800">Email:</strong> {email || 'N/A'} | <strong className="text-gray-800">Tel√©fono:</strong> {phone || 'N/A'}</p>
                                        </div>
                                    </div>
                                    {/* Mostrar bot√≥n de Nueva Evaluaci√≥n solo en modo web */}
                                    <button
                                        onClick={resetEvaluation}
                                        className="hidden print:hidden lg:flex items-center gap-2 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-bold"
                                    >
                                        üîÑ Nueva Evaluaci√≥n
                                    </button>
                                </div>
                                
                                {/* Score General */}
                                <div className="bg-gradient-to-r from-green-100 to-blue-100 rounded-xl p-6 mb-6">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <p className="text-gray-600 text-lg mb-2">Puntaje Total</p>
                                            <p className="text-6xl font-bold" style={{ color: overallLevel.color }}>
                                                {totalScore}<span className="text-3xl text-gray-500">/{getMaxScore()}</span>
                                            </p>
                                        </div>
                                        <div className="text-right">
                                            <p className="text-8xl mb-2">{overallLevel.icon}</p>
                                            <p className="text-2xl font-bold" style={{ color: overallLevel.color }}>
                                                {overallLevel.level}
                                            </p>
                                        </div>
                                    </div>
                                    <div className="mt-4 p-4 bg-white rounded-lg">
                                        <p className="text-gray-700 text-lg">{overallLevel.description}</p>
                                        <p className="text-gray-600 mt-2">
                                            <strong>Tiempo estimado:</strong> {overallLevel.timeframe}
                                        </p>
                                    </div>
                                </div>

                                {/* Priority Alert */}
                                <div className="bg-yellow-50 border-l-4 border-yellow-500 text-yellow-800 p-4 mb-6 rounded-lg shadow-md">
                                    <h3 className="text-xl font-bold mb-2">Prioridad de Acci√≥n</h3>
                                    <p className="font-semibold">{overallLevel.priority}</p>
                                </div>

                                {/* Submission Status */}
                                <div className="p-4 bg-gray-100 rounded-lg text-center text-sm">
                                    {submissionMessage}
                                </div>

                            </div>
                            
                            {/* Gr√°ficos y An√°lisis por Dimensi√≥n */}
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                {/* Gr√°fico Radar */}
                                <div className="bg-white rounded-2xl shadow-xl p-6">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Desempe√±o por Dimensi√≥n (Radar)</h2>
                                    <RadarChartDisplay 
                                        data={radarData} 
                                        colors={{ hex: overallLevel.color, rgb: overallLevel.color.replace('#', '1,1,1') }} 
                                    />
                                </div>

                                {/* Gr√°fico de Barras */}
                                <div className="bg-white rounded-2xl shadow-xl p-6">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Nivel de Madurez por √Årea</h2>
                                    <BarChartDisplay data={barData} />
                                </div>
                            </div>

                            {/* Recomendaciones Detalladas */}
                            <div className="bg-white rounded-2xl shadow-xl p-8 mb-6">
                                <h2 className="text-3xl font-bold text-gray-800 mb-6 border-b pb-3">Hoja de Ruta Digital Sugerida</h2>
                                <p className="text-lg text-gray-700 mb-6">Basado en su nivel **{overallLevel.level}**, estas son las **pr√≥ximas acciones clave** para avanzar en su madurez digital:</p>
                                
                                <ul className="space-y-4">
                                    {overallLevel.actions.map((action, index) => (
                                        <li key={index} className="flex items-start bg-blue-50 p-4 rounded-lg shadow-sm">
                                            <span className="text-2xl mr-3 text-blue-600">üöÄ</span>
                                            <p className="text-gray-700 font-medium">{action}</p>
                                        </li>
                                    ))}
                                </ul>

                                <h3 className="text-2xl font-bold text-gray-800 mt-8 mb-4">An√°lisis Detallado de Dimensiones</h3>
                                <div className="space-y-6">
                                    {barData.map(dim => {
                                        const dimension = dimensions.find(d => d.name === dim.name.substring(3)); // Quitar el emoji
                                        const scorePercent = Math.round((dim.score / 25) * 100);
                                        const levelInfo = getDimensionLevel(dim.score);
                                        
                                        let recommendationText = '';
                                        if (levelInfo.level === 1) recommendationText = `**Prioridad Alta:** Necesita digitalizar sus procesos en ${dimension.name} para obtener control y eficiencia.`;
                                        if (levelInfo.level === 2) recommendationText = `**Foco:** Debe consolidar las herramientas existentes y buscar soluciones espec√≠ficas de gesti√≥n para ${dimension.name}.`;
                                        if (levelInfo.level === 3) recommendationText = `**Optimizaci√≥n:** Utilice los datos que ya recolecta para an√°lisis y automatizaci√≥n de procesos clave en ${dimension.name}.`;
                                        if (levelInfo.level === 4) recommendationText = `**Inversi√≥n en Innovaci√≥n:** Explore el uso de IA y telemetr√≠a para la toma de decisiones predictivas en ${dimension.name}.`;
                                        if (levelInfo.level === 5) recommendationText = `**Liderazgo:** Mantenga la inversi√≥n y explore nuevas tecnolog√≠as. Puede servir de mentor a otras √°reas o empresas.`;

                                        return (
                                            <div key={dim.name} className="border-b pb-4">
                                                <div className="flex justify-between items-center mb-2">
                                                    <h4 className="text-xl font-semibold text-gray-700">{dim.name} ({levelInfo.label})</h4>
                                                    <span className="text-2xl font-bold" style={{ color: dim.color }}>{dim.score}/25</span>
                                                </div>
                                                <div className="w-full bg-gray-200 rounded-full h-2.5 mb-2">
                                                    <div className="h-2.5 rounded-full" style={{ width: `${scorePercent}%`, backgroundColor: dim.color }}></div>
                                                </div>
                                                <p className="text-gray-600 italic mt-2" dangerouslySetInnerHTML={{ __html: recommendationText }}></p>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                            
                            {/* Footer/Botones de acci√≥n */}
                            <div className="flex justify-between bg-white rounded-2xl shadow-xl p-6 sticky bottom-0 z-10">
                                <button
                                    onClick={() => window.print()}
                                    className="flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-bold"
                                >
                                    üñ®Ô∏è Imprimir/Guardar PDF
                                </button>
                                <button
                                    onClick={resetEvaluation}
                                    className="flex items-center gap-2 px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors font-bold"
                                >
                                    üîÑ Empezar de Nuevo
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }


            // --- VISTA DE FORMULARIO DE EVALUACI√ìN (Paso a Paso) ---

            // Ajuste para el paso actual: 0 = Contacto, 1 a 6 = Dimensiones
            const currentDimensionIndex = currentStep - 1;
            const currentDimension = dimensions[currentDimensionIndex];

            // Renderizar Paso 0: Formulario de Contacto
            if (currentStep === 0) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-indigo-50 to-pink-50 flex items-center justify-center p-4">
                        <div className="w-full max-w-2xl bg-white rounded-2xl shadow-2xl p-8 transform transition-all duration-500">
                            <h1 className="text-3xl font-extrabold text-gray-900 mb-2">
                                üöÄ Evaluaci√≥n de Madurez Digital Agropecuaria
                            </h1>
                            <p className="text-gray-600 mb-6 border-b pb-4">
                                Ingrese sus datos para personalizar su reporte.
                            </p>

                            <InputField 
                                label="Nombre de la Empresa/Finca" 
                                id="companyName" 
                                value={companyName} 
                                onChange={setCompanyName} 
                                required={true}
                            />
                            <InputField 
                                label="Nombre del Contacto" 
                                id="personName" 
                                value={personName} 
                                onChange={setPersonName} 
                                required={true}
                            />
                            <InputField 
                                label="Cargo o Rol" 
                                id="position" 
                                value={position} 
                                onChange={setPosition}
                            />
                            <InputField 
                                label="Correo Electr√≥nico" 
                                id="email" 
                                value={email} 
                                onChange={setEmail} 
                                type="email"
                            />
                            <InputField 
                                label="Tel√©fono" 
                                id="phone" 
                                value={phone} 
                                onChange={setPhone} 
                                type="tel"
                            />

                            <div className="mt-8 flex justify-end">
                                <button
                                    onClick={goToNextStep}
                                    disabled={!isContactStepComplete}
                                    className={`
                                        flex items-center gap-2 px-6 py-3 rounded-lg font-bold transition-all
                                        ${!isContactStepComplete 
                                            ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                            : 'bg-green-500 text-white hover:bg-green-600'
                                        }
                                    `}
                                >
                                    Comenzar Evaluaci√≥n ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // Renderizar Pasos de Preguntas (1 a 6)
            return (
                <div className="min-h-screen bg-gradient-to-br from-green-50 to-blue-50 p-4 pt-10">
                    <div className="max-w-4xl mx-auto bg-white rounded-2xl shadow-2xl p-8">
                        
                        {/* Indicador de Progreso */}
                        <div className="mb-8">
                            <h2 className="text-lg font-medium text-gray-500 mb-2">
                                Progreso General: {Math.round(progressPercentage())}%
                            </h2>
                            <div className="w-full bg-gray-200 rounded-full h-2.5">
                                <div 
                                    className="bg-green-500 h-2.5 rounded-full transition-all duration-500" 
                                    style={{ width: `${progressPercentage()}%` }}
                                ></div>
                            </div>
                        </div>

                        {/* Encabezado del Paso Actual */}
                        <div className="mb-8 border-b pb-4">
                            <p className="text-xl font-bold text-blue-600 mb-1">
                                Paso {currentStep} de {dimensions.length}:
                            </p>
                            <h1 className="text-4xl font-extrabold text-gray-900 flex items-center gap-3">
                                <span className="text-5xl">{currentDimension.icon}</span>
                                {currentDimension.name}
                            </h1>
                            <p className="text-gray-600 mt-2">
                                Seleccione la opci√≥n que mejor describa el estado actual de su empresa en esta dimensi√≥n.
                            </p>
                        </div>
                        
                        {/* Preguntas de la Dimensi√≥n */}
                        <div className="space-y-8">
                            {currentDimension.questions.map((q, index) => (
                                <div key={q.id} className="border-b pb-6 last:border-b-0">
                                    <h3 className="text-lg font-semibold text-gray-800 mb-3">
                                        {index + 1}. {q.text}
                                    </h3>
                                    <div className="space-y-3">
                                        {q.options.map(opt => {
                                            const isSelected = responses[q.id] === opt.value;
                                            return (
                                                <button
                                                    key={opt.value}
                                                    onClick={() => handleResponse(q.id, opt.value)}
                                                    className={`
                                                        w-full text-left p-4 rounded-lg border-2 transition-all duration-200
                                                        ${isSelected 
                                                            ? 'border-green-500 bg-green-50 text-green-800 shadow-md font-medium'
                                                            : 'border-gray-200 bg-white hover:border-blue-300 text-gray-700'
                                                        }
                                                    `}
                                                >
                                                    {opt.label}
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* Navegaci√≥n */}
                        <div className="mt-10 pt-6 border-t flex justify-between">
                            <button
                                onClick={goToPrevStep}
                                disabled={currentStep <= 1} // No permite ir atr√°s desde el Paso 1 (a contacto)
                                className={`
                                    flex items-center gap-2 px-6 py-3 rounded-lg font-bold transition-all
                                    ${currentStep <= 1 
                                        ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                        : 'bg-indigo-500 text-white hover:bg-indigo-600'
                                    }
                                `}
                            >
                                ‚Üê Anterior
                            </button>

                            <button
                                onClick={goToNextStep}
                                // Aqu√≠ se revisa si todas las preguntas del paso de preguntas est√°n respondidas.
                                disabled={!isStepComplete()} 
                                className={`
                                    flex items-center gap-2 px-6 py-3 rounded-lg font-bold transition-all
                                    ${
                                        !isStepComplete() 
                                            ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                            : currentStep < dimensions.length 
                                            ? 'bg-green-500 text-white hover:bg-green-600'
                                            : 'bg-purple-600 text-white hover:bg-purple-700' // Bot√≥n de Ver Resultados
                                    }
                                `}
                            >
                                {currentStep < dimensions.length ? (
                                    <>
                                        Siguiente ‚Üí
                                    </>
                                ) : (
                                    <>
                                        Ver Resultados üèÜ
                                    </>
                                )}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        // Inicializaci√≥n de la aplicaci√≥n React
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<MadurezDigitalAgro />);

    </script>
</body>
</html>
